<itemdata datadefinition="Name" template="default" />
<ItemData DataDefinition="Body" Template="default" />

<div class="google-map-module">

  <div class="google-map-link-panel">
    <h2>Current Construction</h2>   
	<h3>Layers</h3>

  </div>
    
  <a href="#" class="enlarge-map" id='contractButton' style='display:none'>Shink Map</a>
  <a href="#" class="enlarge-map" id='expandButton'>Enlarge Map</a>
      
    <div id="googleMap" class="google-map-container" style='width:635px; height:433px;'></div> 
    
    <!-- expands to width 960px and height 655px -->
    <!-- google-map-container -->
 
</div>  

<script>

$(document).ready(function(){
    
	//Variables
  var args, 
    mapMarkers;
    
    
  //Map properties
  args = {
        expandButton : document.getElementById('expandButton'),
        contractButton : document.getElementById('contractButton'),
        rssMarkers: ['http://cmstest.ssc.nsw.gov.au/utils/WebProxy.ashx?http://ssc-webapp1.ssc.council:885/feed.ashx']
    };
    
  //Load Map
  mapManager(document.getElementById('googleMap'),args, function(myMap){
  
  mapMarkers = myMap.markers;
  //mayLayers = myMap.layers  
  
    //When map is loaded
    var i, x, y, z, docFrag, containerList, liControls, liLayers, liLayer, layerList, markerList, layerName;
      
      //Build list of links
		//$('.google-map-link-panel').append('<h3>Markers</h3><ul style="list-style-type:none">');
    
        //Loop through all layers
		//for (y in myMap.layers){
	//docFrag = document.createDocumentFragment();
	containerList = document.createElement('ul');
	//$(containerList).append('AAARRRGGH!!!');
	//$(docFrag).append($(containerList));
	
	$('.google-map-link-panel').append($(containerList));
	 
	for(y=0, z=myMap.layers.length;y<z;y+=1){
	
		if (myMap.layers[y] !== 'other' && myMap.layers[y] !== 'Test' ){
			//remove the spaces from the layer name to use as an id
			layerName = myMap.layers[y].replace(/ /g,'');
			
			//Create layer item to hold this layer
			liLayer = document.createElement('li');
			
			$(containerList).append($(liLayer));
			
			//Create a list to hold the controls and markers for this layer
			layerList = document.createElement("ul");
			
			//Add this layers list to the list of layer lists (say that 10 times fast)
			$(liLayer).append($(layerList));
			
			//Create list items to hold layer controls and markers
			liLayers = document.createElement('li');
			liControls = document.createElement('li');
			
			//Add list items to container list
			$(layerList).append($(liControls));
			$(layerList).append($(liLayers));

		
			//Add id and class names to the list
			layerList.className = 'layerContainer';
			layerList.id= 'container_' + layerName;
		
			//Add layer controls to the layer list
			$(liControls).append('<h3><a href="#" class="layer_toggle_button" id="' + layerName + '">' + myMap.layers[y] + '</a> - Show on map <input type = "radio" class="layer_plot_button" id=' + layerName + ' onMouseDown="this.__chk = this.checked" onClick="if (this.__chk) this.checked = false" checked="checked"></h3>');
		
			//Create a list to display all the markers for this layer
			markerList = document.createElement('ul');
			markerList.className = "layerHeading";
			markerList.id = 'list_' + layerName;
		
		//$('.google-map-link-panel').append('<ul id="container_' + myMap.layers[y].replace(/ /g,'') + '" class="layerContainer" style="list-display-type:none">');
		//$('#container_' + myMap.layers[y].replace(/ /g,'')).append('<li><h3><a href="#" class="layer_toggle_button" id="' + layerName + '">' + myMap.layers[y] + '</a> - <a href="#" class="layer_plot_button" id=' + layerName + '>Hide</a></h3></li>');
		//'$('#container_' + myMap.layers[y].replace(/ /g,'')).append('<ul style="list-style-type:none" class="layerHeading" id="list_' + myMap.layers[y].replace(/ /g,'') + '">');
    
			//Loop through every marker
			for (i in myMap.markers){
				if (myMap.markers[i].layerId === myMap.layers[y]){
        
					//Create a link. This will open the infoBox on hover
					$(markerList).append('<li class="' + myMap.layers[y].replace(/ /g,'') + '"><a href="#" class="map_plot_button" id="' + myMap.markers[i].pageId + '">' + myMap.markers[i].pageName + '</a></li>');
				}	
      
				//$('.google-map-link-panel').append('</ul>');
      
			}
		
		$(liLayers).append($(markerList));
		
		}
     
	  
	}
             
             
      //End list of marker links
  
    //Click event listener for layer links
	
    $('.layer_plot_button').click(function(e){
		
		console.log(e.currentTarget.id);
		
      //variables
      var i, x;
      console.log(myMap.markers);
      //Loop through all the markers
      for (i in myMap.markers){
        
		console.log(myMap.markers[i].layerId.replace(/ /g,''));
		console.log(myMap.markers[i].layerId + ' vs ' + e.currentTarget.id);
		
        //Identify markers that match the layer button clicked
        if (myMap.markers[i].layerId.replace(/ /g,'') == e.currentTarget.id){
          
          //Check if visible or not and toggle.
          if(myMap.markers[i].marker.visible){
            myMap.markers[i].marker.setVisible(false);
          }else{
            myMap.markers[i].marker.setVisible(true);
          }
          
          console.log(myMap.markers[i].marker.visible);
          console.log(myMap.markers[i].marker);
        }
        
      }
      
      return false;
      
      });        
			
			var activeList;
			
	$('.layerContainer').click(
		function(e){
			
			activeList = '#list_' + e.currentTarget.id.replace('container_','');

			$(activeList).slideToggle();

			return false	
		}
	);	
	
     //Hover event of every map_plot_button class link
     $('.map_plot_button').hover(function(e){
  
          //Use the id of the hovered link to build the id of its 
          //corresponding map marker
          var x = "a" + e.currentTarget.id.replace(/-/g,'') + "marker";

          //Open the markers info window
          google.maps.event.trigger(myMap.markers[x].marker, 'click');
            
     }, function(e){
     
        var x = "a" + e.currentTarget.id.replace(/-/g,'') + "marker";
       myMap.markers[x].marker.infobox.close();
       
       
     });   

	$('.layerHeading').each(function(){
	
		$(this).toggle();
	
	});
   
});



  $('#expandButton').click(function(){$('#expandButton').toggle();$('#contractButton').toggle();});
  $('#contractButton').click(function(){$('#expandButton').toggle();$('#contractButton').toggle();});
     
 
    
});
  
</script>
<p>
<a href='#' id='testLink'>Click Me Alice</a>
</p>





